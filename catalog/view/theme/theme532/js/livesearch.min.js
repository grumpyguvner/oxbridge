function doLiveSearch(b,a){if(b.keyCode==38||b.keyCode==40){return false}$("#livesearch_search_results").remove();updown=-1;if(a==""||a.length<3){return false}a=encodeURI(a);$.ajax({url:$("base").attr("href")+"index.php?route=product/search/ajax&keyword="+a,dataType:"json",content:this,success:function(c){if(c.length>0){var h=document.createElement("ul");h.id="livesearch_search_results";var g;var d;var f;for(var e in c){g=document.createElement("li");f=document.createElement("a");$(function(){d=document.createElement("img");d.className="loading";$(d).load(function(){$(this).show()});d.src=c[e].image;f.appendChild(d)});f.appendChild(document.createTextNode(c[e].name));if(typeof(c[e].href)!="undefined"){f.href=c[e].href}else{f.href=$("base").attr("href")+"index.php?route=product/product&product_id="+c[e].product_id+"&keyword="+a}g.appendChild(f);h.appendChild(g)}if($("#livesearch_search_results").length>0){$("#livesearch_search_results").remove()}$("#search").append(h)}}});return true}function upDownEvent(d){var c=document.getElementById("livesearch_search_results");var b=$("#search").find("[name=search]").first();if(c){var a=c.childNodes.length-1;if(updown!=-1&&typeof(c.childNodes[updown])!="undefined"){$(c.childNodes[updown]).removeClass("highlighted")}if(d.keyCode==38){updown=(updown>0)?--updown:updown}else{if(d.keyCode==40){updown=(updown<a)?++updown:updown}}if(updown>=0&&updown<=a){$(c.childNodes[updown]).addClass("highlighted");var e=c.childNodes[updown].childNodes[0].text;if(typeof(e)=="undefined"){e=c.childNodes[updown].childNodes[0].innerText}$("#search").find("[name=search]").first().val(new String(e).replace(/(\s\(.*?\))$/,""))}}return false}var updown=-1;$(document).ready(function(){$("#search").find("[name=search]").first().keyup(function(a){doLiveSearch(a,this.value)}).focus(function(a){doLiveSearch(a,this.value)}).keydown(function(a){upDownEvent(a)}).blur(function(){window.setTimeout("$('#livesearch_search_results').remove();updown=0;",600)});$(document).bind("keydown",function(a){try{if(a.keyCode==13&&$(".highlighted").length>0){document.location.href=$(".highlighted").find("a").first().attr("href")}}catch(b){}})});